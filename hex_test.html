<script src="./PixiJS/pixi.min.js"></script>
<script>
(async () => {
  // инициализация
  const app = new PIXI.Application();
  await app.init({ resizeTo: window, background: '#202020', antialias: true });
  document.getElementById('app').appendChild(app.canvas);

  // проверка (синий прямоугольник)
  const test = new PIXI.Graphics().rect(20, 20, 120, 60).fill({ color: 0x3b82f6 });
  app.stage.addChild(test);

  // ---- HEX math (pointy-top) ----
  const SQRT3 = Math.sqrt(3);
  const size = 40;                                  // радиус шестиугольника в px
  const center = { x: app.renderer.width/2, y: app.renderer.height/2 };

  // axial (q,r) -> пиксели
  const axialToPixel = (q, r) => ({
    x: size * (SQRT3*q + (SQRT3/2)*r),
    y: size * (1.5*r)
  });

  // вершины одного шестиугольника (локальные координаты)
  const hexPoints = (() => {
    const pts = [];
    for (let i=0;i<6;i++){
      const a = (Math.PI/180) * (60*i - 30);        // pointy-top
      pts.push(Math.cos(a)*size, Math.sin(a)*size);
    }
    return pts;
  })();

  // рисуем кольца R=0..N (bottom-up)
  const maxR = 3;                                   // увеличивай радиус для большего поля
  for (let r=0; r<=maxR; r++){
    // сгенерировать кольцо радиуса r
    const ring = [];
    if (r===0) ring.push({q:0, r:0});
    else {
      let q = r, rr = -r;
      const dirs = [ [-1,0], [-1,1], [0,1], [1,0], [1,-1], [0,-1] ];
      for (const [dq,dr] of dirs){
        for (let i=0;i<r;i++){ ring.push({q, r: rr}); q+=dq; rr+=dr; }
      }
    }
    // отрисовать кольцо
    for (const h of ring){
      const {x,y} = axialToPixel(h.q, h.r);
      const g = new PIXI.Graphics();
      g.poly(hexPoints, true).fill({ color: 0x88cc88, alpha: Math.max(0.2, 1 - r*0.1) })
                             .stroke({ color: 0xffffff, width:1, alpha:0.35 });
      g.x = center.x + x; g.y = center.y + y;
      g.eventMode = 'static'; g.cursor = 'pointer';
      g.on('pointerover', () => g.tint = 0xff6666);
      g.on('pointerout',  () => g.tint = 0xffffff);
      app.stage.addChild(g);

      // подпись (q,r)
      const label = new PIXI.Text({ text: `${h.q},${h.r}`, style: { fill: 0xffffff, fontSize: 12 } });
      label.anchor.set(0.5); label.x = g.x; label.y = g.y;
      app.stage.addChild(label);
    }
  }
})();
</script>
