<script src="./PixiJS/pixi.min.js?v=1"></script>
<script>
(async () => {
  const app = new PIXI.Application();
  await app.init({ resizeTo: window, background: '#202020', antialias: true });
  document.body.appendChild(app.canvas);

  // ---- HEX math (pointy-top axial) ----
  const SQRT3 = Math.sqrt(3);
  const size = 40;
  const axialToPixel = (q, r) => ({
    x: size * (SQRT3 * q + (SQRT3/2) * r),
    y: size * (1.5 * r)
  });
  const hexPts = (() => {
    const p = [];
    for (let i = 0; i < 6; i++) {
      const a = (Math.PI/180) * (60*i - 30);
      p.push(Math.cos(a)*size, Math.sin(a)*size);
    }
    return p;
  })();

  // шесть базовых направлений (pointy-top)
  const DIRS = [
    {q:+1, r: 0}, {q:+1, r:-1}, {q: 0, r:-1},
    {q:-1, r: 0}, {q:-1, r:+1}, {q: 0, r:+1}
  ];

  // утилиты
  const key = (q,r)=>`${q},${r}`;
  const cells = new Map(); // уникальные ячейки

  function addCell(q, r, color, alpha=0.75) {
    const { x, y } = axialToPixel(q, r);
    const g = new PIXI.Graphics();
    g.poly(hexPts, true).fill({ color, alpha }).stroke({ color: 0xffffff, width:1, alpha:0.28 });
    g.x = app.renderer.width/2 + x;
    g.y = app.renderer.height/2 + y;
    app.stage.addChild(g);
    cells.set(key(q,r), {q,r,g});
  }

  // 1) центр (зелёный)
  addCell(0, 0, 0x82b07a, 0.8);

  // 2) кольцо радиуса 1: 6 соседей вокруг центра (получим и «направление» для лучей)
  const ring1 = [];
  for (const d of DIRS) {
    const q = d.q, r = d.r;
    ring1.push({q,r,dir:d});
    addCell(q, r, 0x6aa9ff, 0.65); // синие
  }

  // 3) от каждого соседа — вектор из 3 гексов наружу по его направлению
  for (const h of ring1) {
    const dq = h.dir.q, dr = h.dir.r;
    // стартуем от соседа и идём дальше: +1, +2, +3 шаги
    for (let step = 1; step <= 3; step++) {
      const q = h.q + dq*step;
      const r = h.r + dr*step;
      if (!cells.has(key(q,r))) addCell(q, r, 0xffb86b, 0.75); // оранжевые «лучи»
    }
  }

  // подписи (необязательно — можете убрать)
  for (const {q,r,g} of cells.values()) {
    const t = new PIXI.Text({ text: `${q},${r}`, style: { fill: 0xffffff, fontSize: 12 } });
    t.anchor.set(0.5); t.x = g.x; t.y = g.y;
    app.stage.addChild(t);
  }
})();
</script>
